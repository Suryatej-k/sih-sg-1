<!DOCTYPE html>
<html>
<head>
    <title>SGaaS Monitoring System</title>
    <link rel="stylesheet" type="text/css" href="dstyle.css">
</head>
<body>
    <header>
        <h1>Smart Grid Monitoring System</h1>
    </header>
    <nav>
        <button class="tablinks" onclick="openTab(event, 'Daily View')">Daily View</button>
        <button class="tablinks" onclick="openTab(event, 'Monthly View')">Monthly View</button>
        <button class="tablinks" onclick="openTab(event, 'Yearly View')">Yearly View</button>
        <span id="userId" style="float: right;">Admin ID: <%=userId%></span>
        <a href="/logout">Logout</a>
    </nav>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    var myChart; // Declare myChart globally so it can be accessed in openTab function

function openTab(event, tabName) {
    // Get the h2 tag with id "name" and change its content based on the active button
    var h2tag = document.getElementById("name");
    h2tag.innerHTML = tabName;

    // Add an "active" class to the button that opened the tab
    var tablinks = document.getElementsByClassName("tablinks");
    for (var i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    event.currentTarget.className += " active";

    // Update chart labels based on the active view
    var labels;
    if (tabName === 'Daily View') {
        labels = Array.from({length: 24}, (_, i) => i + 'h');
    } else if (tabName === 'Monthly View') {
        labels = Array.from({length: 30}, (_, i) => i + 'd');
    } else if (tabName === 'Yearly View') {
        labels = Array.from({length: 365}, (_, i) => i + 'd');
    }
    myChart.data.labels = labels;
    myChart.update();
}

window.onload = function() {
    var ctx = document.getElementById('myChart').getContext('2d');
    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: 24}, (_, i) => i + 'h'), // Default to Daily View
            datasets: [{
                label: 'Power consumption [kW]',
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Make 'Daily View' active on page load
    openTab({currentTarget: document.querySelector(".tablinks")}, 'Daily View');
}
</script>
<main>
    <section style="display: flex;">
        <div>
            <h2 id="name"></h2>
            <p>Grid Power [E/M]</p>
            <p>Time</p>
            <p><b>State:</b></p>
            <p>Feed-in mode</p>
            <p><b>Live values:</b></p>
            <p>Generator Power -24.98 kW</p>
            <p>Grid Power -24.49 kW</p>
        </div>
        <div>
            <canvas id="myChart"></canvas>
        </div>
    </section>
</main>
    <footer>
        <p>Â© 2023 SGaas</p>
    </footer>
</body>
</html>